(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/commponent/goods/poster"],{"189f":function(t,e,n){"use strict";var o;n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}));var a=function(){var t=this,e=t.$createElement;t._self._c},s=[]},"2bba":function(t,e,n){"use strict";n.r(e);var o=n("fdc7"),a=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=a.a},"3a5d":function(t,e,n){},"5e36":function(t,e,n){"use strict";var o=n("3a5d"),a=n.n(o);a.a},"84d2":function(t,e,n){"use strict";n.r(e);var o=n("189f"),a=n("2bba");for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);n("5e36");var i,r=n("f0c5"),c=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"e1ba5ac8",null,!1,o["a"],i);e["default"]=c.exports},fdc7:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(n("a34a")),a=n("cced");function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e,n,o,a,s,i){try{var r=t[s](i),c=r.value}catch(l){return void n(l)}r.done?e(c):Promise.resolve(c).then(o,a)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var s=t.apply(e,n);function r(t){i(s,o,a,r,c,"next",t)}function c(t){i(s,o,a,r,c,"throw",t)}r(void 0)}))}}var c=getApp(),l=function(){n.e("pages/commponent/public/loading").then(function(){return resolve(n("ef74"))}.bind(null,n)).catch(n.oe)},u={data:function(){return{windowWidth:"",windowHeight:"",colors:"",ctx:"",imgUrl:"",userInfo:{name:"反转",logo:"/static/images/face.jpg"}}},components:{loading:l},props:{posterData:{type:Object}},created:function(){this.getSystem(),this.setData({colors:c.globalData.newColor}),this.setPoster()},onReachBottom:function(){},onShareAppMessage:function(){},methods:{getSystem:function(){var e=this;t.getSystemInfo({success:function(t){console.log(t),e.setData({windowHeight:t.windowHeight,windowWidth:t.windowWidth})}})},setPoster:function(){var e=this;return r(o.default.mark((function n(){var s,i,r,c,l,u,f;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.userInfo=(0,a.getUserInfo)()||{},t.showLoading({title:"海报生成中..."}),s=t.createCanvasContext("mycanvas",e),s.fillStyle="#FFFFFF",s.fillRect(0,0,e.windowWidth-60,520),n.next=7,e.setText(s,14,"#333",85,35,e.userInfo.nickName);case 7:return n.next=9,e.setText(s,12,"#999",85,58,"为您精心挑选了一个好礼物");case 9:return s.save(),s.beginPath(),i=60,r=60,c=15,l=15,u=8,n.next=18,e.setRadius(s,i,r,c,l,u);case 18:return n.next=20,e.setGoodsImg(s);case 20:return f="￥ "+(e.posterData.skus[0].activityPrice||e.posterData.skus[0].salePrice),n.next=23,e.setText(s,20,e.colors,15,420,f);case 23:return n.next=25,e.setGoodsName(s);case 25:s.save();case 26:case"end":return n.stop()}}),n)})))()},setEwm:function(e){var n=this;console.log("生成二维码");var o=100,a=100,s=this.windowWidth-170;e.drawImage("/static/images/ewm.png",s,410,o,a),setTimeout((function(){e.save(),e.draw(!1,(function(){setTimeout((function(){t.canvasToTempFilePath({canvasId:"mycanvas",success:function(t){console.log("---------------"),console.log(t),n.imgUrl=t.tempFilePath}},n)}),200)})),t.hideLoading()}),1e3)},setRadius:function(t,e,n,a,s,i){var c=this;return r(o.default.mark((function r(){var l;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.arc(a+i,s+i,i,Math.PI,3*Math.PI/2),t.lineTo(e-i+a,s),t.arc(e-i+a,i+s,i,3*Math.PI/2,2*Math.PI),t.lineTo(e+a,n+s-i),t.arc(e-i+a,n-i+s,i,0,1*Math.PI/2),t.lineTo(i+a,n+s),t.arc(i+a,n-i+s,i,1*Math.PI/2,Math.PI),t.strokeStyle="#fff",t.fill(),t.clip(),o.next=12,c.downloadFile(c.userInfo.avatarUrl);case 12:l=o.sent,console.log(l),t.drawImage(l,a,s,e,n),t.closePath(),t.restore();case 17:case"end":return o.stop()}}),r)})))()},setCircular:function(t,e,n,o,a){t.arc(e/2+o,n/2+a,e/2,0,2*Math.PI,!1),t.strokeStyle="#fff",t.fill(),t.clip(),t.drawImage(this.userInfo.logo,o,a,e,n),t.closePath(),t.restore()},setGoodsImg:function(t){var e=this;return r(o.default.mark((function n(){var a,s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.windowWidth-120,n.next=3,e.downloadFile(e.posterData.bigImg[0]);case 3:s=n.sent,t.drawImage(s,30,95,a,a),t.save();case 6:case"end":return n.stop()}}),n)})))()},setText:function(t,e,n,o,a,s,i){t.setFillStyle(n),t.setTextAlign("left"),t.font=i?"normal bold 20px Arial,sans-serif":"normal 20px Arial,sans-serif",t.setFontSize(e),t.fillText(s,o,a),t.restore()},setGoodsName:function(t){for(var e={x:20,y:440,width:180,height:20,line:3,color:"#333333",size:14,align:"left",baseline:"top",text:"".concat(this.posterData.name," ").concat(this.posterData.subhead),bold:!0},n=Math.ceil(e.width/e.size),o=Math.ceil(e.text.length/n),a=0;a<o;a++){var s={x:e.x,y:e.y+a*e.height,color:e.color,size:e.size,align:e.align,baseline:e.baseline,text:e.text.substring(a*n,(a+1)*n),bold:e.bold};a<e.line&&(a==e.line-1&&(s.text=s.text.substring(0,s.text.length-3)+"......"),this.drawText(t,s))}this.setEwm(t)},drawText:function(t,e){console.log("渲染文字",e),t.save(),t.setFillStyle(e.color),t.setFontSize(e.size),t.setTextAlign(e.align),t.setTextBaseline(e.baseline),e.bold&&(console.log("字体加粗"),t.fillText(e.text,e.x,e.y-.1),t.fillText(e.text,e.x-.1,e.y)),t.fillText(e.text,e.x,e.y),e.bold&&(t.fillText(e.text,e.x,e.y+.1),t.fillText(e.text,e.x+.1,e.y)),t.restore()},saveImg:function(){t.showLoading({title:"保存中..."});var e=this;t.getSetting({success:function(n){t.hideLoading(),console.log(n),n.authSetting["scope.writePhotosAlbum"]?setTimeout((function(){t.saveImageToPhotosAlbum({filePath:e.imgUrl,success:function(e){t.hideLoading(),t.showToast({title:"保存成功",icon:"success"})},fail:function(e){console.log(e),t.showToast({title:"保存失败",icon:"none"})}})}),1e3):wx.authorize({scope:"scope.writePhotosAlbum",success:function(t){console.log(t)}})}})},downloadFile:function(e){return r(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){t.downloadFile({url:e,success:function(t){n(t.tempFilePath)}})})));case 1:case"end":return n.stop()}}),n)})))()}}};e.default=u}).call(this,n("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/commponent/goods/poster-create-component',
    {
        'pages/commponent/goods/poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("84d2"))
        })
    },
    [['pages/commponent/goods/poster-create-component']]
]);
