(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/commponent/goods/poster"],{"2bba":function(t,e,o){"use strict";o.r(e);var s=o("fdc7"),i=o.n(s);for(var n in s)"default"!==n&&function(t){o.d(e,t,(function(){return s[t]}))}(n);e["default"]=i.a},"60c4":function(t,e,o){"use strict";var s=o("e81e"),i=o.n(s);i.a},"84d2":function(t,e,o){"use strict";o.r(e);var s=o("f271"),i=o("2bba");for(var n in i)"default"!==n&&function(t){o.d(e,t,(function(){return i[t]}))}(n);o("60c4");var a,l=o("f0c5"),c=Object(l["a"])(i["default"],s["b"],s["c"],!1,null,"7049f39c",null,!1,s["a"],a);e["default"]=c.exports},e81e:function(t,e,o){},f271:function(t,e,o){"use strict";var s;o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return n})),o.d(e,"a",(function(){return s}));var i=function(){var t=this,e=t.$createElement;t._self._c},n=[]},fdc7:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=getApp(),i=function(){o.e("pages/commponent/public/loading").then(function(){return resolve(o("ef74"))}.bind(null,o)).catch(o.oe)},n={data:function(){return{windowWidth:"",windowHeight:"",colors:"",ctx:"",imgUrl:"",userInfo:{name:"反转",logo:"/static/images/face.jpg",goodsImg:"/static/images/goods/one.jpg",price:"3599.00",goodsName:"魅族17 8GB+128GB 十七度灰 骁龙865 旗舰5G手机 30W快充 6400W后置主摄 90Hz屏幕 支持NFC 智能拍照游戏手机"}}},components:{loading:i},props:{posterData:{type:Object}},created:function(){this.getSystem(),this.setData({colors:s.globalData.newColor}),this.setPoster()},onReachBottom:function(){},onShareAppMessage:function(){},methods:{getSystem:function(){var e=this;t.getSystemInfo({success:function(t){console.log(t),e.setData({windowHeight:t.windowHeight,windowWidth:t.windowWidth})}})},setPoster:function(){t.showLoading({title:"海报生成中..."});var e=t.createCanvasContext("mycanvas",this);e.fillStyle="#FFFFFF",e.fillRect(0,0,this.windowWidth-60,520);var o=function(t,e,o,s,i,n,a){t.setFillStyle(o),t.setTextAlign("left"),t.font=a?"normal bold 20px Arial,sans-serif":"normal 20px Arial,sans-serif",t.setFontSize(e),t.fillText(n,s,i),t.restore()};o(e,14,"#333",85,35,this.userInfo.name,"bold"),o(e,12,"#999",85,58,"为您精心挑选了一个好礼物"),e.save(),e.beginPath();var s=60,i=60,n=15,a=15,l=8;this.setRadius(e,s,i,n,a,l),this.setGoodsImg(e);var c="￥ "+(this.posterData.skus[0].activityPrice||this.posterData.skus[0].salePrice);this.setGoodsPrice(e,20,this.colors,15,410,c),this.setGoodsName(e)},setEwm:function(e){var o=this;console.log("生成二维码");var s=100,i=100,n=this.windowWidth-170;e.drawImage("/static/images/ewm.png",n,410,s,i),setTimeout((function(){e.save(),e.draw(!1,(function(){setTimeout((function(){t.canvasToTempFilePath({canvasId:"mycanvas",success:function(t){console.log(t),o.imgUrl=t.tempFilePath}},o)}),200)})),t.hideLoading()}),1e3)},setRadius:function(t,e,o,s,i,n){t.arc(s+n,i+n,n,Math.PI,3*Math.PI/2),t.lineTo(e-n+s,i),t.arc(e-n+s,n+i,n,3*Math.PI/2,2*Math.PI),t.lineTo(e+s,o+i-n),t.arc(e-n+s,o-n+i,n,0,1*Math.PI/2),t.lineTo(n+s,o+i),t.arc(n+s,o-n+i,n,1*Math.PI/2,Math.PI),t.strokeStyle="#fff",t.fill(),t.clip(),t.drawImage(this.userInfo.logo,s,i,e,o),t.closePath(),t.restore()},setCircular:function(t,e,o,s,i){t.arc(e/2+s,o/2+i,e/2,0,2*Math.PI,!1),t.strokeStyle="#fff",t.fill(),t.clip(),t.drawImage(this.userInfo.logo,s,i,e,o),t.closePath(),t.restore()},setGoodsImg:function(t){var e=this.windowWidth-90;t.drawImage(this.posterData.bigImg[0],15,95,e,e),t.save()},setGoodsPrice:function(t,e,o,s,i,n,a){t.setFillStyle(o),t.setTextAlign("left"),t.font=a?"normal bold 20px Arial,sans-serif":"normal 20px Arial,sans-serif",t.setFontSize(e),t.fillText(n,s,i),t.restore()},setGoodsName:function(t){for(var e={x:20,y:440,width:210,height:20,line:2,color:"#202020",size:14,align:"left",baseline:"top",text:"".concat(this.posterData.name," ").concat(this.posterData.subhead),bold:!0},o=Math.ceil(e.width/e.size),s=Math.ceil(e.text.length/o),i=0;i<s;i++){var n={x:e.x,y:e.y+i*e.height,color:e.color,size:e.size,align:e.align,baseline:e.baseline,text:e.text.substring(i*o,(i+1)*o),bold:e.bold};i<e.line&&(i==e.line-1&&(n.text=n.text.substring(0,n.text.length-3)+"......"),this.drawText(t,n))}this.setEwm(t)},drawText:function(t,e){console.log("渲染文字",e),t.save(),t.setFillStyle(e.color),t.setFontSize(e.size),t.setTextAlign(e.align),t.setTextBaseline(e.baseline),e.bold&&(console.log("字体加粗"),t.fillText(e.text,e.x,e.y-.1),t.fillText(e.text,e.x-.1,e.y)),t.fillText(e.text,e.x,e.y),e.bold&&(t.fillText(e.text,e.x,e.y+.1),t.fillText(e.text,e.x+.1,e.y)),t.restore()},saveImg:function(){t.showLoading({title:"保存中..."});var e=this;t.getSetting({success:function(o){t.hideLoading(),console.log(o),o.authSetting["scope.writePhotosAlbum"]?setTimeout((function(){t.saveImageToPhotosAlbum({filePath:e.imgUrl,success:function(e){t.hideLoading(),t.showToast({title:"保存成功",icon:"success"})},fail:function(e){console.log(e),t.showToast({title:"保存失败",icon:"none"})}})}),1e3):wx.authorize({scope:"scope.writePhotosAlbum",success:function(t){console.log(t)}})}})}}};e.default=n}).call(this,o("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/commponent/goods/poster-create-component',
    {
        'pages/commponent/goods/poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("84d2"))
        })
    },
    [['pages/commponent/goods/poster-create-component']]
]);
