(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/views/tabBar/cart"],{"09be":function(t,n,e){"use strict";e.r(n);var r=e("f331"),a=e("c6fe");for(var u in a)"default"!==u&&function(t){e.d(n,t,(function(){return a[t]}))}(u);e("4035");var i,o=e("f0c5"),c=Object(o["a"])(a["default"],r["b"],r["c"],!1,null,"5a879f3c",null,!1,r["a"],i);n["default"]=c.exports},4035:function(t,n,e){"use strict";var r=e("c609"),a=e.n(r);a.a},"47ef":function(t,n,e){"use strict";(function(t){e("fffe");r(e("66fd"));var n=r(e("09be"));function r(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},a950:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=u(e("a34a")),a=e("cced");function u(t){return t&&t.__esModule?t:{default:t}}function i(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function o(t,n,e,r,a,u,i){try{var o=t[u](i),c=o.value}catch(s){return void e(s)}o.done?n(c):Promise.resolve(c).then(r,a)}function c(t){return function(){var n=this,e=arguments;return new Promise((function(r,a){var u=t.apply(n,e);function i(t){o(u,r,a,i,c,"next",t)}function c(t){o(u,r,a,i,c,"throw",t)}i(void 0)}))}}var s=getApp(),f={data:function(){return{colors:"",cartList:[],current:99999,allCurrent:!1,sum:0,sumPrice:0,lock:!1,bottomShow:"",isLogin:!0}},components:{},props:{},onLoad:function(t){this.bottomShow=0},onReady:function(){},onShow:function(){var t=c(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.setData({colors:s.globalData.newColor,current:"99999",allCurrent:!1,sum:0,sumPrice:0}),(0,a.getToken)()){t.next=4;break}return this.isLogin=!1,t.abrupt("return");case 4:return this.isLogin=!0,this.setTabBarBadge(),t.next=8,this.getCart();case 8:n=t.sent,this.setData({cartList:n});case 10:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{getCart:function(){return t.$ajax("/api/cart/list").catch((function(t){return t})).catch((function(n){return t.showToast({title:n,icon:"none"})}))},formatAttr:function(t){return JSON.parse(t).map((function(t){return t.val})).join(" | ")},setCurrent:function(t,n){var e;if(!t.failure){var r=this.cartList,a=this.cartList[n];a.current=!a.current;var u="cartList["+n+"]",o=!1,c=[];r.forEach((function(t){1==t.current&&c.push(t)})),c.length==r.length&&(o=!0),this.setData((e={},i(e,u,a),i(e,"allCurrent",o),e)),this.getSumprice()}},onshowDel:function(t,n){this.setData({current:n,lock:!0})},delItem:function(n,e){var a=this;return c(r.default.mark((function u(){return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$ajax("/api/cart/del",{ids:[n.id]},"post").catch((function(n){return t.showToast({title:n,icon:"none"})}));case 2:a.cartList.splice(e,1),a.setData({current:"9999",lock:!1}),t.showToast({title:"删除成功",icon:"none"}),a.setTabBarBadge();case 6:case"end":return r.stop()}}),u)})))()},oncencal:function(){this.setData({current:"99999"})},onsub:function(n,e){var a=this;return c(r.default.mark((function e(){var u;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(n.failure||n.quantity<=1)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$ajax("/api/cart/add",{productId:n.productId,productSkuId:n.productSkuId,quantity:-1,type:1},"post").catch((function(n){return t.showToast({title:n,icon:"none"})}));case 4:e.sent,u=n.quantity-1,a.$set(n,"quantity",u),a.getSumprice(),a.setTabBarBadge();case 9:case"end":return e.stop()}}),e)})))()},onadd:function(n,e){var a=this;return c(r.default.mark((function e(){var u;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.failure){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$ajax("/api/cart/add",{productId:n.productId,productSkuId:n.productSkuId,quantity:1,type:1},"post").catch((function(n){return t.showToast({title:n,icon:"none"})}));case 4:e.sent,u=n.quantity+1,a.$set(n,"quantity",u),a.getSumprice(),a.setTabBarBadge();case 9:case"end":return e.stop()}}),e)})))()},setAllCurrent:function(){var n=this,e=n.cartList,r=n.allCurrent,a=!0;e.forEach((function(n){1==n.status&&(t.showToast({title:"存在失效商品",icon:"none"}),a=!1)})),0!=a&&(e.forEach((function(t){t.current=!r})),r=!r,n.setData({cartList:e,allCurrent:r}),n.getSumprice())},getSumprice:function(){var t=this,n=t.cartList,e="",r=[];n.forEach((function(t){1!=t.current||t.failure||r.push(t)}));for(var a=r.length,u=0;u<a;u++){var i=r[u];e=(Number(e)+Number(Number(i.activityPrice||i.salePrice)*i.quantity)).toFixed(2)}t.sum=a,t.sumPrice=e},ontouchend:function(){var t=this;this.lock&&setTimeout((function(){t.setData({lock:!1})}),100)},clearInvalid:function(){var n=this;return c(r.default.mark((function e(){var a,u;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=[],u=[],n.cartList.forEach((function(t,e){t.failure&&(a.push(t.id),u.push(n.cartList.splice(e,1))),t.current=!1})),!(a.length<1)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,t.$ajax("/api/cart/del",{ids:a},"post").catch((function(n){return t.showToast({title:n,icon:"none"})}));case 7:t.showToast({title:"清空成功~",icon:"none"}),n.setTabBarBadge();case 9:case"end":return e.stop()}}),e)})))()},delectAll:function(){this.cartList=[],(0,a.removeCart)(),this.setTabBarBadge()},jumpDetails:function(n,e){1==n.failure||this.lock||t.navigateTo({url:"/pages/views/goods/goodsDetails?productId="+n.productId})},settlement:function(){if(0!=this.sum){var n=[];this.cartList.forEach((function(t){1==t.current&&n.push(t)})),console.log(n),(0,a.setGoodsData)(n),setTimeout((function(){t.hideLoading(),t.navigateTo({url:"/pages/views/order/confirmOrder"})}),300)}},onStroll:function(){t.switchTab({url:"/pages/views/tabBar/category"})},goLogin:function(){t.navigateTo({url:"/pages/login/login"})}}};n.default=f}).call(this,e("543d")["default"])},c609:function(t,n,e){},c6fe:function(t,n,e){"use strict";e.r(n);var r=e("a950"),a=e.n(r);for(var u in r)"default"!==u&&function(t){e.d(n,t,(function(){return r[t]}))}(u);n["default"]=a.a},f331:function(t,n,e){"use strict";var r;e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return u})),e.d(n,"a",(function(){return r}));var a=function(){var t=this,n=t.$createElement,e=(t._self._c,0!==t.cartList.length?t.__map(t.cartList,(function(n,e){var r=t.__get_orig(n),a="[]"!==n.attributeJson?t.formatAttr(n.attributeJson):null,u=(Number(n.activityPrice||n.salePrice)*n.quantity).toFixed(2);return{$orig:r,m0:a,g0:u}})):null);t.$mp.data=Object.assign({},{$root:{l0:e}})},u=[]}},[["47ef","common/runtime","common/vendor"]]]);